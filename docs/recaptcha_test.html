<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>reCAPTCHA v2 - Obtener token</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif; margin: 24px; color: #1f2937; }
    .card { max-width: 820px; margin: 0 auto; border: 1px solid #e5e7eb; border-radius: 12px; padding: 20px; box-shadow: 0 4px 18px rgba(0,0,0,.06); background: #fff; }
    h1 { font-size: 20px; margin: 0 0 8px; }
    p { margin: 8px 0; }
    label { display: block; font-weight: 600; margin: 14px 0 6px; }
    input[type="text"], textarea { width: 100%; box-sizing: border-box; border: 1px solid #d1d5db; border-radius: 8px; padding: 10px 12px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    textarea { min-height: 150px; resize: vertical; }
    .row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    .btn { display: inline-flex; align-items: center; gap: 8px; background: #111827; color: #fff; border: none; border-radius: 8px; padding: 10px 14px; cursor: pointer; font-weight: 600; }
    .btn.secondary { background: #374151; }
    .hint { font-size: 12px; color: #6b7280; }
    .ok { color: #059669; font-weight: 600; }
    .err { color: #dc2626; font-weight: 600; }
    .widget { margin-top: 12px; }
    code { background: #f3f4f6; padding: 1px 6px; border-radius: 6px; }
  </style>
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  <script>
    let widgetId = null;
    function renderWidget() {
      const container = document.getElementById('captcha');
      const siteKey = document.getElementById('siteKey').value.trim();
      const status = document.getElementById('status');
      status.textContent = '';
      if (!siteKey) {
        status.textContent = 'Falta Site Key';
        status.className = 'err';
        return;
      }
      container.innerHTML = '';
      try {
        widgetId = grecaptcha.render('captcha', {
          'sitekey': siteKey,
          'callback': onSolved,
          'expired-callback': onExpired,
        });
        status.textContent = 'Widget renderizado. Marca la casilla para obtener token.';
        status.className = 'hint';
      } catch (e) {
        status.textContent = 'No se pudo renderizar el widget.';
        status.className = 'err';
      }
    }
    function onSolved() {
      const token = grecaptcha.getResponse(widgetId);
      document.getElementById('token').value = token;
      const status = document.getElementById('status');
      status.textContent = 'Token listo (cópialo para usarlo en recaptchaToken).';
      status.className = 'ok';
    }
    function onExpired() {
      const status = document.getElementById('status');
      status.textContent = 'Token expirado. Vuelve a marcar la casilla.';
      status.className = 'err';
      document.getElementById('token').value = '';
    }
    function resetWidget() {
      if (widgetId !== null) {
        grecaptcha.reset(widgetId);
        document.getElementById('token').value = '';
        const status = document.getElementById('status');
        status.textContent = 'Widget reiniciado.';
        status.className = 'hint';
      }
    }
    function copyToken() {
      const out = document.getElementById('token');
      out.select();
      document.execCommand('copy');
    }
  </script>
</head>
<body>
  <div class="card">
    <h1>Generador de token reCAPTCHA v2</h1>
    <p>Usa este HTML para obtener el <code>token</code> y pegarlo en tus mutaciones como <code>recaptchaToken</code>.</p>
    <p class="hint">Registra tu sitio reCAPTCHA v2 y usa tu <strong>Site Key</strong> aquí. El backend usa tu <strong>Secret</strong> desde <code>config/settings.py</code>.</p>

    <label>Site Key</label>
    <input id="siteKey" type="text" placeholder="TU_SITE_KEY_V2" value="" />

    <div class="row">
      <button class="btn" onclick="renderWidget()">Renderizar Widget</button>
      <button class="btn secondary" onclick="resetWidget()">Reiniciar</button>
      <span id="status" class="hint"></span>
    </div>

    <div id="captcha" class="widget"></div>

    <label style="margin-top:14px;">Token</label>
    <textarea id="token" readonly placeholder="Aquí aparecerá el token"></textarea>

    <div class="row">
      <button class="btn secondary" onclick="copyToken()">Copiar token</button>
    </div>

    <hr style="margin:18px 0;"/>

    <h3>Ejemplo de login (GraphQL)</h3>
    <pre><code>mutation Login($username:String!, $password:String!, $recaptchaToken:String!){
  tokenAuth(username:$username, password:$password, recaptchaToken:$recaptchaToken){
    success
    message
    token
    refreshToken
    user { id email username role isActive }
  }
}

Variables:
{
  "username": "cristian.lara",
  "password": "2021000001",
  "recaptchaToken": "&lt;pegar_aqui_token&gt;"
}
</code></pre>
  </div>
</body>
</html>
