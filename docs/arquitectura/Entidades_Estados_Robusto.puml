@startuml
!theme plain
top to bottom direction

title Diagrama de Entidades y Estados - Sistema PPP UPeU

' === ENTIDADES PRINCIPALES ===

entity "upeu_escuela" as escuela {
  * id : INTEGER <<PK>>
  --
  * nombre : VARCHAR(100)
  * codigo : VARCHAR(10)
  * descripcion : TEXT
  * estado : ENUM(ACTIVO, INACTIVO)
}

entity "upeu_usuario" as usuario {
  * id : INTEGER <<PK>>
  --
  * correo : VARCHAR(100) <<UNIQUE>>
  * hash_contraseña : VARCHAR(255)
  * nombres : VARCHAR(100)
  * apellidos : VARCHAR(100)
  * dni : VARCHAR(8) <<UNIQUE>>
  * telefono : VARCHAR(15)
  * rol_id : INTEGER <<FK>>
  * escuela_id : INTEGER <<FK>>
  * activo : BOOLEAN
  * fecha_creacion : TIMESTAMP
}

entity "upeu_rol" as rol {
  * id : INTEGER <<PK>>
  --
  * nombre : ENUM(PRACTICANTE, SUPERVISOR, SECRETARIA, COORDINADOR, ADMINISTRADOR, SUPERADMIN)
  * descripcion : TEXT
}

entity "upeu_rama" as rama {
  * id : INTEGER <<PK>>
  --
  * nombre : VARCHAR(100)
  * descripcion : TEXT
  * escuela_id : INTEGER <<FK>>
}

entity "upeu_perfil_practicante" as practicante {
  * id : INTEGER <<PK>>
  --
  * usuario_id : INTEGER <<FK>> <<UNIQUE>>
  * codigo : VARCHAR(10) <<UNIQUE>>
  * semestre : INTEGER
  * promedio : DECIMAL(4,2)
  * fecha_nacimiento : DATE
  * direccion : TEXT
  * escuela_id : INTEGER <<FK>>
  * rama_id : INTEGER <<FK>>
  * cv_path : VARCHAR(255)
  * fecha_cv_subido : TIMESTAMP
}

entity "upeu_empresa" as empresa {
  * id : INTEGER <<PK>>
  --
  * nombre : VARCHAR(150)
  * ruc : VARCHAR(11) <<UNIQUE>>
  * direccion : TEXT
  * telefono : VARCHAR(15)
  * correo : VARCHAR(100)
  * estado : ENUM(ACTIVO, INACTIVO)
  * validado_por : INTEGER <<FK>>
  * fecha_validacion : TIMESTAMP
}

entity "upeu_perfil_supervisor" as supervisor {
  * id : INTEGER <<PK>>
  --
  * usuario_id : INTEGER <<FK>> <<UNIQUE>>
  * empresa_id : INTEGER <<FK>>
  * cargo : VARCHAR(100)
  * telefono : VARCHAR(15)
  * correo : VARCHAR(100)
}

entity "upeu_practica" as practica {
  * id : INTEGER <<PK>>
  --
  * practicante_id : INTEGER <<FK>>
  * empresa_id : INTEGER <<FK>>
  * supervisor_id : INTEGER <<FK>>
  * coordinador_id : INTEGER <<FK>>
  * secretaria_id : INTEGER <<FK>>
  * fecha_inicio : DATE
  * fecha_fin : DATE
  * horas_totales : INTEGER
  * estado : ENUM
  * fecha_creacion : TIMESTAMP
  * fecha_actualizacion : TIMESTAMP
}

entity "upeu_oportunidad_laboral" as oportunidad {
  * id : INTEGER <<PK>>
  --
  * empresa_id : INTEGER <<FK>>
  * titulo : VARCHAR(200)
  * descripcion : TEXT
  * rama_id : INTEGER <<FK>>
  * requisitos : TEXT
  * fecha_publicacion : TIMESTAMP
  * fecha_cierre : DATE
  * estado : ENUM(ACTIVO, INACTIVO)
}

entity "upeu_postulacion_oportunidad" as postulacion {
  * id : INTEGER <<PK>>
  --
  * oportunidad_id : INTEGER <<FK>>
  * practicante_id : INTEGER <<FK>>
  * fecha_postulacion : TIMESTAMP
  * estado : ENUM(PENDIENTE, ACEPTADO, RECHAZADO)
  * comentario : TEXT
}

entity "upeu_documento_practica" as documento {
  * id : INTEGER <<PK>>
  --
  * practica_id : INTEGER <<FK>>
  * tipo_documento_id : INTEGER <<FK>>
  * ruta_archivo : VARCHAR(255)
  * subido_por : INTEGER <<FK>>
  * fecha_subida : TIMESTAMP
  * estado : ENUM(PENDIENTE, VALIDADO, RECHAZADO)
  * validado_por : INTEGER <<FK>>
  * fecha_validacion : TIMESTAMP
  * comentario : TEXT
}

' === ESTADOS DE PRÁCTICA ===

note top of practica : Estados de Práctica
note as estado_practica
**Estados de Práctica:**
• BORRADOR: Práctica en proceso de creación
• PENDIENTE: Enviada para revisión
• APROBADO: Aprobada por coordinador
• EN_PROGRESO: Práctica en ejecución
• COMPLETADO: Práctica finalizada
• RECHAZADO: Práctica rechazada
end note

estado_practica .. practica

' === RELACIONES PRINCIPALES ===

' Escuela
escuela ||--o{ usuario
escuela ||--o{ practicante
escuela ||--o{ rama

' Usuario y roles
rol ||--o{ usuario
usuario ||--o| practicante
usuario ||--o| supervisor

' Practicante
practicante }o--|| rama
practicante ||--o{ practica
practicante ||--o{ postulacion

' Empresa
empresa ||--o{ supervisor
empresa ||--o{ practica
empresa ||--o{ oportunidad

' Supervisor
supervisor ||--o{ practica

' Práctica
practica ||--o{ documento

' Oportunidades laborales
rama ||--o{ oportunidad
oportunidad ||--o{ postulacion

' === DIAGRAMA DE ESTADOS ===

state "Estado de Práctica" as EstadoPractica {
  [*] --> BORRADOR : Crear práctica
  BORRADOR --> PENDIENTE : Enviar para revisión
  PENDIENTE --> APROBADO : Coordinador aprueba
  PENDIENTE --> RECHAZADO : Coordinador rechaza
  APROBADO --> EN_PROGRESO : Iniciar práctica
  EN_PROGRESO --> COMPLETADO : Finalizar práctica
  RECHAZADO --> BORRADOR : Corregir y reenviar
  COMPLETADO --> [*]
}

@enduml
